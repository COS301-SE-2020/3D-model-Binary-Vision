function cov_1v1ht9ly1k(){var path="/home/marcus/UNI/Year 3/COS 301/Capstone/redemo/3D-model-Binary-Vision/Application/api/controller/EmailController.js";var hash="7b1c5c0ab4b18de6f629a55dcc035c80421a71ad";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcus/UNI/Year 3/COS 301/Capstone/redemo/3D-model-Binary-Vision/Application/api/controller/EmailController.js",statementMap:{"0":{start:{line:5,column:17},end:{line:5,column:38}},"1":{start:{line:6,column:50},end:{line:6,column:82}},"2":{start:{line:20,column:18},end:{line:29,column:4}},"3":{start:{line:31,column:0},end:{line:83,column:1}},"4":{start:{line:39,column:24},end:{line:39,column:32}},"5":{start:{line:41,column:8},end:{line:65,column:11}},"6":{start:{line:42,column:12},end:{line:64,column:13}},"7":{start:{line:44,column:16},end:{line:44,column:44}},"8":{start:{line:45,column:16},end:{line:45,column:43}},"9":{start:{line:46,column:16},end:{line:46,column:23}},"10":{start:{line:50,column:16},end:{line:63,column:20}},"11":{start:{line:52,column:20},end:{line:62,column:22}},"12":{start:{line:54,column:25},end:{line:54,column:53}},"13":{start:{line:55,column:25},end:{line:55,column:52}},"14":{start:{line:56,column:25},end:{line:56,column:32}},"15":{start:{line:60,column:25},end:{line:60,column:56}},"16":{start:{line:61,column:25},end:{line:61,column:32}},"17":{start:{line:66,column:8},end:{line:66,column:15}},"18":{start:{line:75,column:8},end:{line:80,column:9}},"19":{start:{line:91,column:16},end:{line:91,column:30}},"20":{start:{line:92,column:17},end:{line:92,column:45}},"21":{start:{line:93,column:13},end:{line:93,column:23}},"22":{start:{line:95,column:4},end:{line:101,column:7}},"23":{start:{line:97,column:8},end:{line:99,column:9}},"24":{start:{line:98,column:12},end:{line:98,column:29}},"25":{start:{line:105,column:4},end:{line:110,column:5}},"26":{start:{line:114,column:17},end:{line:114,column:101}},"27":{start:{line:115,column:4},end:{line:115,column:99}},"28":{start:{line:116,column:4},end:{line:116,column:102}},"29":{start:{line:118,column:4},end:{line:124,column:7}},"30":{start:{line:120,column:8},end:{line:123,column:9}},"31":{start:{line:122,column:12},end:{line:122,column:31}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:36,column:25},end:{line:36,column:26}},loc:{start:{line:37,column:4},end:{line:67,column:5}},line:37},"1":{name:"(anonymous_1)",decl:{start:{line:41,column:33},end:{line:41,column:34}},loc:{start:{line:41,column:54},end:{line:65,column:9}},line:41},"2":{name:"(anonymous_2)",decl:{start:{line:50,column:46},end:{line:50,column:47}},loc:{start:{line:51,column:16},end:{line:63,column:18}},line:51},"3":{name:"(anonymous_3)",decl:{start:{line:72,column:17},end:{line:72,column:18}},loc:{start:{line:73,column:4},end:{line:82,column:5}},line:73},"4":{name:"sendPasswordResetEmail",decl:{start:{line:89,column:9},end:{line:89,column:31}},loc:{start:{line:90,column:0},end:{line:126,column:1}},line:90},"5":{name:"(anonymous_5)",decl:{start:{line:95,column:16},end:{line:95,column:17}},loc:{start:{line:96,column:4},end:{line:101,column:5}},line:96},"6":{name:"(anonymous_6)",decl:{start:{line:118,column:48},end:{line:118,column:49}},loc:{start:{line:119,column:4},end:{line:124,column:5}},line:119}},branchMap:{"0":{loc:{start:{line:42,column:12},end:{line:64,column:13}},type:"if",locations:[{start:{line:42,column:12},end:{line:64,column:13}},{start:{line:42,column:12},end:{line:64,column:13}}],line:42},"1":{loc:{start:{line:52,column:20},end:{line:62,column:22}},type:"if",locations:[{start:{line:52,column:20},end:{line:62,column:22}},{start:{line:52,column:20},end:{line:62,column:22}}],line:52},"2":{loc:{start:{line:97,column:8},end:{line:99,column:9}},type:"if",locations:[{start:{line:97,column:8},end:{line:99,column:9}},{start:{line:97,column:8},end:{line:99,column:9}}],line:97},"3":{loc:{start:{line:120,column:8},end:{line:123,column:9}},type:"if",locations:[{start:{line:120,column:8},end:{line:123,column:9}},{start:{line:120,column:8},end:{line:123,column:9}}],line:120}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7b1c5c0ab4b18de6f629a55dcc035c80421a71ad"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1v1ht9ly1k=function(){return actualCoverage;};}return actualCoverage;}cov_1v1ht9ly1k();//Created by Jacobus Janse van Rensburg
//
//This file contains the API function declarations and implementations for all functionality of sending emails to users
var nodeMailer=(cov_1v1ht9ly1k().s[0]++,require('nodemailer'));const{Doctor,Receptionist,PasswordChanges}=(cov_1v1ht9ly1k().s[1]++,require('../model/3DModelModel'));//var transporter = nodeMailer.createTransport({
//    host:"smtp.mailtrap.io",
//    port: 2525,
//    auth:{
//        user:"0c9f2b08034ef4",
//        pass:"c1fd4b36bbc842"
//    } 
//});
var transporter=(cov_1v1ht9ly1k().s[2]++,nodeMailer.createTransport({service:'gmail',host:'smtp.gmail.com',port:465,secure:true,auth:{user:'flap.jacks.cs@gmail.com',pass:'ampjiedsvncvukaz'}}));cov_1v1ht9ly1k().s[3]++;module.exports={//========================================================================================
//function developed by Jacobus Janse van Rensburg
//sends a email to the user to allow the user to change their passwords
passwordChangeEmail:function(req,res){cov_1v1ht9ly1k().f[0]++;// need to see if the email is actually in the database
const{email}=(cov_1v1ht9ly1k().s[4]++,req.body);cov_1v1ht9ly1k().s[5]++;Doctor.findOne({email},function(err,doctor){cov_1v1ht9ly1k().f[1]++;cov_1v1ht9ly1k().s[6]++;if(doctor){cov_1v1ht9ly1k().b[0][0]++;cov_1v1ht9ly1k().s[7]++;sendPasswordResetEmail(req);cov_1v1ht9ly1k().s[8]++;res.status(200).send("ok");cov_1v1ht9ly1k().s[9]++;return;}else{cov_1v1ht9ly1k().b[0][1]++;cov_1v1ht9ly1k().s[10]++;Receptionist.findOne({email},function(err,receptionist){cov_1v1ht9ly1k().f[2]++;cov_1v1ht9ly1k().s[11]++;if(receptionist){cov_1v1ht9ly1k().b[1][0]++;cov_1v1ht9ly1k().s[12]++;sendPasswordResetEmail(req);cov_1v1ht9ly1k().s[13]++;res.status(200).send("ok");cov_1v1ht9ly1k().s[14]++;return;}else{cov_1v1ht9ly1k().b[1][1]++;cov_1v1ht9ly1k().s[15]++;res.status(400).send("not ok");cov_1v1ht9ly1k().s[16]++;return;}});}});cov_1v1ht9ly1k().s[17]++;return;},//===================================================================================
//function developed by Jacobus Janse van Rensburg
signupEmail:function(req,res){cov_1v1ht9ly1k().f[3]++;var passwordChangeOptions=(cov_1v1ht9ly1k().s[18]++,{from:'flap.jacks.cs@gmail.com',to:req.body.email,subject:'3D Render Password Change',html:'<div style="background-color: #343a40; width: 400px; padding: 10px; border-radius: 10px; position:relative;margin:0 auto; margin-top: 100px;"><h1 style="color:white;text-align: center;">Password Reset</h1><hr><h2 style="color:lightblue;text-align: center;" id="emailLink">USER_EMAIL_HERE</h2><p style="text-align: center; color:white;">You have requested to change your password. <br>Click on the link below to reset your password.</p><div style="text-align:center;"><a style="color:lightblue;" href="RESET_PASSWORD_URL">Reset Password</a></div><hr><p style="text-align: center; color:white; font-size: 13px;">If this was not you, please ignore this email.<br>Your passowrd will remain the same.</p></div>'});}};//======================================================================================================
//function developed by: Jacobus Jane van Rensburg 
//Email HTML developed by rani
//function that sends the actual email to reset the users password
function sendPasswordResetEmail(req){cov_1v1ht9ly1k().f[4]++;var email=(cov_1v1ht9ly1k().s[19]++,req.body.email);var record=(cov_1v1ht9ly1k().s[20]++,new PasswordChanges({email}));var id=(cov_1v1ht9ly1k().s[21]++,record._id);//store a temporary record in the database with a id to mach for a valid password change 
cov_1v1ht9ly1k().s[22]++;record.save(function(err){cov_1v1ht9ly1k().f[5]++;cov_1v1ht9ly1k().s[23]++;if(err){cov_1v1ht9ly1k().b[2][0]++;cov_1v1ht9ly1k().s[24]++;console.log(err);}else{cov_1v1ht9ly1k().b[2][1]++;}});//setting the details of the email to be sent
var passwordChangeOptions=(cov_1v1ht9ly1k().s[25]++,{from:'flap.jacks.cs@gmail.com',to:req.body.email,subject:'3D Render Password Change',html:'<div style="background-color: #343a40; width: 400px; padding: 10px; border-radius: 10px; position:relative;margin:0 auto; margin-top: 100px;"><h1 style="color:white;text-align: center;">Password Reset</h1><hr><h2 style="color:lightblue;text-align: center;" id="emailLink">USER_EMAIL_HERE</h2><p style="text-align: center; color:white;">You have requested to change your password. <br>Click on the link below to reset your password.</p><div style="text-align:center;"><a style="color:lightblue;" href="RESET_PASSWORD_URL">Reset Password</a></div><hr><p style="text-align: center; color:white; font-size: 13px;">If this was not you, please ignore this email.<br>Your passowrd will remain the same.</p></div>'});// setting the variants in the email that is dependent on certain users
// var resetURL="lacalhost:3000/ResetPassword.html?email="+req.body.email+"&code="+id;
var resetURL=(cov_1v1ht9ly1k().s[26]++,"https://flapjacks.goodx.co.za/ResetPassword.html?email="+req.body.email+"&code="+id);cov_1v1ht9ly1k().s[27]++;passwordChangeOptions.html=passwordChangeOptions.html.replace('RESET_PASSWORD_URL',resetURL);cov_1v1ht9ly1k().s[28]++;passwordChangeOptions.html=passwordChangeOptions.html.replace('USER_EMAIL_HERE',req.body.email);//send the actual email
cov_1v1ht9ly1k().s[29]++;transporter.sendMail(passwordChangeOptions,function(error,info){cov_1v1ht9ly1k().f[6]++;cov_1v1ht9ly1k().s[30]++;if(error){cov_1v1ht9ly1k().b[3][0]++;cov_1v1ht9ly1k().s[31]++;console.log(error);}else{cov_1v1ht9ly1k().b[3][1]++;}});}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkVtYWlsQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJub2RlTWFpbGVyIiwicmVxdWlyZSIsIkRvY3RvciIsIlJlY2VwdGlvbmlzdCIsIlBhc3N3b3JkQ2hhbmdlcyIsInRyYW5zcG9ydGVyIiwiY3JlYXRlVHJhbnNwb3J0Iiwic2VydmljZSIsImhvc3QiLCJwb3J0Iiwic2VjdXJlIiwiYXV0aCIsInVzZXIiLCJwYXNzIiwibW9kdWxlIiwiZXhwb3J0cyIsInBhc3N3b3JkQ2hhbmdlRW1haWwiLCJyZXEiLCJyZXMiLCJlbWFpbCIsImJvZHkiLCJmaW5kT25lIiwiZXJyIiwiZG9jdG9yIiwic2VuZFBhc3N3b3JkUmVzZXRFbWFpbCIsInN0YXR1cyIsInNlbmQiLCJyZWNlcHRpb25pc3QiLCJzaWdudXBFbWFpbCIsInBhc3N3b3JkQ2hhbmdlT3B0aW9ucyIsImZyb20iLCJ0byIsInN1YmplY3QiLCJodG1sIiwicmVjb3JkIiwiaWQiLCJfaWQiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsInJlc2V0VVJMIiwicmVwbGFjZSIsInNlbmRNYWlsIiwiZXJyb3IiLCJpbmZvIl0sIm1hcHBpbmdzIjoicWlKQWVZOzJGQWZaO0FBQ0E7QUFDQTtBQUVBLEdBQUlBLENBQUFBLFVBQVUsMEJBQUdDLE9BQU8sQ0FBQyxZQUFELENBQVYsQ0FBZCxDQUNBLEtBQU0sQ0FBRUMsTUFBRixDQUFVQyxZQUFWLENBQXdCQyxlQUF4QiwyQkFBNENILE9BQU8sQ0FBQyx1QkFBRCxDQUFuRCxDQUFOLENBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBLEdBQUlJLENBQUFBLFdBQVcsMEJBQUdMLFVBQVUsQ0FBQ00sZUFBWCxDQUEyQixDQUMxQ0MsT0FBTyxDQUFFLE9BRGlDLENBRTFDQyxJQUFJLENBQUUsZ0JBRm9DLENBRzFDQyxJQUFJLENBQUUsR0FIb0MsQ0FJMUNDLE1BQU0sQ0FBRSxJQUprQyxDQUsxQ0MsSUFBSSxDQUFFLENBQ0NDLElBQUksQ0FBRSx5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QixDQUFDSSxJQUF0QixDQUEyQlEsT0FBM0IsQ0FBbUMsaUJBQW5DLENBQXFEeEIsR0FBRyxDQUFDRyxJQUFKLENBQVNELEtBQTlELENBQTdCLENBQ0E7QUEzQkoseUJBNEJJZCxXQUFXLENBQUNxQyxRQUFaLENBQXFCYixxQkFBckIsQ0FBNEMsU0FBU2MsS0FBVCxDQUFnQkMsSUFBaEIsQ0FDNUMsa0RBQ0ksR0FBSUQsS0FBSixDQUNBLHFEQUNJTCxPQUFPLENBQUNDLEdBQVIsQ0FBWUksS0FBWixFQUNILENBSEQsaUNBSUgsQ0FORCxFQVFIIiwic291cmNlc0NvbnRlbnQiOlsiLy9DcmVhdGVkIGJ5IEphY29idXMgSmFuc2UgdmFuIFJlbnNidXJnXG4vL1xuLy9UaGlzIGZpbGUgY29udGFpbnMgdGhlIEFQSSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgYW5kIGltcGxlbWVudGF0aW9ucyBmb3IgYWxsIGZ1bmN0aW9uYWxpdHkgb2Ygc2VuZGluZyBlbWFpbHMgdG8gdXNlcnNcblxudmFyIG5vZGVNYWlsZXIgPSByZXF1aXJlKCdub2RlbWFpbGVyJyk7XG5jb25zdCB7IERvY3RvciwgUmVjZXB0aW9uaXN0LCBQYXNzd29yZENoYW5nZXMgfSA9IHJlcXVpcmUoJy4uL21vZGVsLzNETW9kZWxNb2RlbCcpO1xuXG5cbi8vdmFyIHRyYW5zcG9ydGVyID0gbm9kZU1haWxlci5jcmVhdGVUcmFuc3BvcnQoe1xuLy8gICAgaG9zdDpcInNtdHAubWFpbHRyYXAuaW9cIixcbi8vICAgIHBvcnQ6IDI1MjUsXG4vLyAgICBhdXRoOntcbi8vICAgICAgICB1c2VyOlwiMGM5ZjJiMDgwMzRlZjRcIixcbi8vICAgICAgICBwYXNzOlwiYzFmZDRiMzZiYmM4NDJcIlxuLy8gICAgfSBcbi8vfSk7XG5cblxuXG52YXIgdHJhbnNwb3J0ZXIgPSBub2RlTWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7XG4gICBzZXJ2aWNlOiAnZ21haWwnLFxuICAgaG9zdDogJ3NtdHAuZ21haWwuY29tJyxcbiAgIHBvcnQ6IDQ2NSxcbiAgIHNlY3VyZTogdHJ1ZSxcbiAgIGF1dGg6IHtcbiAgICAgICAgICB1c2VyOiAnZmxhcC5qYWNrcy5jc0BnbWFpbC5jb20nLFxuICAgICAgICAgIHBhc3M6ICdhbXBqaWVkc3ZuY3Z1a2F6J1xuICAgICAgfVxuICB9KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvL2Z1bmN0aW9uIGRldmVsb3BlZCBieSBKYWNvYnVzIEphbnNlIHZhbiBSZW5zYnVyZ1xuICAgIC8vc2VuZHMgYSBlbWFpbCB0byB0aGUgdXNlciB0byBhbGxvdyB0aGUgdXNlciB0byBjaGFuZ2UgdGhlaXIgcGFzc3dvcmRzXG4gICAgcGFzc3dvcmRDaGFuZ2VFbWFpbDogZnVuY3Rpb24ocmVxICwgcmVzKVxuICAgIHtcbiAgICAgICAgLy8gbmVlZCB0byBzZWUgaWYgdGhlIGVtYWlsIGlzIGFjdHVhbGx5IGluIHRoZSBkYXRhYmFzZVxuICAgICAgICBjb25zdCB7ZW1haWx9ID0gcmVxLmJvZHk7XG5cbiAgICAgICAgRG9jdG9yLmZpbmRPbmUoe2VtYWlsfSAsIGZ1bmN0aW9uKGVyciwgZG9jdG9yKXtcbiAgICAgICAgICAgIGlmICggZG9jdG9yIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsKHJlcSk7XG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoXCJva1wiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgUmVjZXB0aW9uaXN0LmZpbmRPbmUoe2VtYWlsfSwgZnVuY3Rpb24gKGVyciwgcmVjZXB0aW9uaXN0KVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCByZWNlcHRpb25pc3QgKVxuICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRQYXNzd29yZFJlc2V0RW1haWwocmVxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChcIm9rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgXG4gICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICBlbHNlIFxuICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5zZW5kKFwibm90IG9rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfSxcblxuXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vZnVuY3Rpb24gZGV2ZWxvcGVkIGJ5IEphY29idXMgSmFuc2UgdmFuIFJlbnNidXJnXG4gICAgc2lnbnVwRW1haWw6IGZ1bmN0aW9uIChyZXEgLHJlcylcbiAgICB7XG4gICAgICAgIHZhciBwYXNzd29yZENoYW5nZU9wdGlvbnMgPSBcbiAgICAgICAge1xuICAgICAgICAgICAgZnJvbTogJ2ZsYXAuamFja3MuY3NAZ21haWwuY29tJyxcbiAgICAgICAgICAgIHRvOnJlcS5ib2R5LmVtYWlsLFxuICAgICAgICAgICAgc3ViamVjdDogJzNEIFJlbmRlciBQYXNzd29yZCBDaGFuZ2UnLFxuICAgICAgICAgICAgaHRtbDonPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICMzNDNhNDA7IHdpZHRoOiA0MDBweDsgcGFkZGluZzogMTBweDsgYm9yZGVyLXJhZGl1czogMTBweDsgcG9zaXRpb246cmVsYXRpdmU7bWFyZ2luOjAgYXV0bzsgbWFyZ2luLXRvcDogMTAwcHg7XCI+PGgxIHN0eWxlPVwiY29sb3I6d2hpdGU7dGV4dC1hbGlnbjogY2VudGVyO1wiPlBhc3N3b3JkIFJlc2V0PC9oMT48aHI+PGgyIHN0eWxlPVwiY29sb3I6bGlnaHRibHVlO3RleHQtYWxpZ246IGNlbnRlcjtcIiBpZD1cImVtYWlsTGlua1wiPlVTRVJfRU1BSUxfSEVSRTwvaDI+PHAgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IGNvbG9yOndoaXRlO1wiPllvdSBoYXZlIHJlcXVlc3RlZCB0byBjaGFuZ2UgeW91ciBwYXNzd29yZC4gPGJyPkNsaWNrIG9uIHRoZSBsaW5rIGJlbG93IHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQuPC9wPjxkaXYgc3R5bGU9XCJ0ZXh0LWFsaWduOmNlbnRlcjtcIj48YSBzdHlsZT1cImNvbG9yOmxpZ2h0Ymx1ZTtcIiBocmVmPVwiUkVTRVRfUEFTU1dPUkRfVVJMXCI+UmVzZXQgUGFzc3dvcmQ8L2E+PC9kaXY+PGhyPjxwIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBjb2xvcjp3aGl0ZTsgZm9udC1zaXplOiAxM3B4O1wiPklmIHRoaXMgd2FzIG5vdCB5b3UsIHBsZWFzZSBpZ25vcmUgdGhpcyBlbWFpbC48YnI+WW91ciBwYXNzb3dyZCB3aWxsIHJlbWFpbiB0aGUgc2FtZS48L3A+PC9kaXY+J1xuICAgICAgICB9O1xuXG4gICAgfVxufVxuXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy9mdW5jdGlvbiBkZXZlbG9wZWQgYnk6IEphY29idXMgSmFuZSB2YW4gUmVuc2J1cmcgXG4vL0VtYWlsIEhUTUwgZGV2ZWxvcGVkIGJ5IHJhbmlcbi8vZnVuY3Rpb24gdGhhdCBzZW5kcyB0aGUgYWN0dWFsIGVtYWlsIHRvIHJlc2V0IHRoZSB1c2VycyBwYXNzd29yZFxuZnVuY3Rpb24gc2VuZFBhc3N3b3JkUmVzZXRFbWFpbChyZXEpXG57XG4gICAgdmFyIGVtYWlsID0gcmVxLmJvZHkuZW1haWw7XG4gICAgdmFyIHJlY29yZCA9IG5ldyBQYXNzd29yZENoYW5nZXMoe2VtYWlsfSk7XG4gICAgdmFyIGlkID0gcmVjb3JkLl9pZDtcbiAgICAvL3N0b3JlIGEgdGVtcG9yYXJ5IHJlY29yZCBpbiB0aGUgZGF0YWJhc2Ugd2l0aCBhIGlkIHRvIG1hY2ggZm9yIGEgdmFsaWQgcGFzc3dvcmQgY2hhbmdlIFxuICAgIHJlY29yZC5zYXZlKGZ1bmN0aW9uIChlcnIpXG4gICAge1xuICAgICAgICBpZiAoZXJyKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSk7XG5cbiAgICAvL3NldHRpbmcgdGhlIGRldGFpbHMgb2YgdGhlIGVtYWlsIHRvIGJlIHNlbnRcbiAgICB2YXIgcGFzc3dvcmRDaGFuZ2VPcHRpb25zID0gXG4gICAge1xuICAgICAgICBmcm9tOiAnZmxhcC5qYWNrcy5jc0BnbWFpbC5jb20nLFxuICAgICAgICB0bzpyZXEuYm9keS5lbWFpbCxcbiAgICAgICAgc3ViamVjdDogJzNEIFJlbmRlciBQYXNzd29yZCBDaGFuZ2UnLFxuICAgICAgICBodG1sOic8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogIzM0M2E0MDsgd2lkdGg6IDQwMHB4OyBwYWRkaW5nOiAxMHB4OyBib3JkZXItcmFkaXVzOiAxMHB4OyBwb3NpdGlvbjpyZWxhdGl2ZTttYXJnaW46MCBhdXRvOyBtYXJnaW4tdG9wOiAxMDBweDtcIj48aDEgc3R5bGU9XCJjb2xvcjp3aGl0ZTt0ZXh0LWFsaWduOiBjZW50ZXI7XCI+UGFzc3dvcmQgUmVzZXQ8L2gxPjxocj48aDIgc3R5bGU9XCJjb2xvcjpsaWdodGJsdWU7dGV4dC1hbGlnbjogY2VudGVyO1wiIGlkPVwiZW1haWxMaW5rXCI+VVNFUl9FTUFJTF9IRVJFPC9oMj48cCBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6d2hpdGU7XCI+WW91IGhhdmUgcmVxdWVzdGVkIHRvIGNoYW5nZSB5b3VyIHBhc3N3b3JkLiA8YnI+Q2xpY2sgb24gdGhlIGxpbmsgYmVsb3cgdG8gcmVzZXQgeW91ciBwYXNzd29yZC48L3A+PGRpdiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiPjxhIHN0eWxlPVwiY29sb3I6bGlnaHRibHVlO1wiIGhyZWY9XCJSRVNFVF9QQVNTV09SRF9VUkxcIj5SZXNldCBQYXNzd29yZDwvYT48L2Rpdj48aHI+PHAgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IGNvbG9yOndoaXRlOyBmb250LXNpemU6IDEzcHg7XCI+SWYgdGhpcyB3YXMgbm90IHlvdSwgcGxlYXNlIGlnbm9yZSB0aGlzIGVtYWlsLjxicj5Zb3VyIHBhc3Nvd3JkIHdpbGwgcmVtYWluIHRoZSBzYW1lLjwvcD48L2Rpdj4nXG4gICAgfTtcblxuICAgIC8vIHNldHRpbmcgdGhlIHZhcmlhbnRzIGluIHRoZSBlbWFpbCB0aGF0IGlzIGRlcGVuZGVudCBvbiBjZXJ0YWluIHVzZXJzXG4gICAgLy8gdmFyIHJlc2V0VVJMPVwibGFjYWxob3N0OjMwMDAvUmVzZXRQYXNzd29yZC5odG1sP2VtYWlsPVwiK3JlcS5ib2R5LmVtYWlsK1wiJmNvZGU9XCIraWQ7XG4gICAgdmFyIHJlc2V0VVJMPVwiaHR0cHM6Ly9mbGFwamFja3MuZ29vZHguY28uemEvUmVzZXRQYXNzd29yZC5odG1sP2VtYWlsPVwiK3JlcS5ib2R5LmVtYWlsK1wiJmNvZGU9XCIraWQ7XG4gICAgcGFzc3dvcmRDaGFuZ2VPcHRpb25zLmh0bWwgPSBwYXNzd29yZENoYW5nZU9wdGlvbnMuaHRtbC5yZXBsYWNlKCdSRVNFVF9QQVNTV09SRF9VUkwnLHJlc2V0VVJMKTtcbiAgICBwYXNzd29yZENoYW5nZU9wdGlvbnMuaHRtbCA9IHBhc3N3b3JkQ2hhbmdlT3B0aW9ucy5odG1sLnJlcGxhY2UoJ1VTRVJfRU1BSUxfSEVSRScscmVxLmJvZHkuZW1haWwpO1xuICAgIC8vc2VuZCB0aGUgYWN0dWFsIGVtYWlsXG4gICAgdHJhbnNwb3J0ZXIuc2VuZE1haWwocGFzc3dvcmRDaGFuZ2VPcHRpb25zLCBmdW5jdGlvbihlcnJvciwgaW5mbylcbiAgICB7XG4gICAgICAgIGlmIChlcnJvcikgXG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgfSBcbiAgICB9KTtcblxufVxuIl19